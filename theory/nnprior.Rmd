---
title: "Nuclear norm prior"
author: "Charles Zheng"
date: "06/17/2015"
output: html_document
---

Let
$$
Y = XB + UDV^T + E
$$
where $B_{ij} \sim Exp(1)$, $U_{n \times r}$ and $V_{r \times v}$ are random orthogonal,
and $D = \text{diag}(D_1, ..., D_r)$ with $D_r \sim Exp(\nu)$, and $E_{ij} \sim N(0, \sigma^2)$.

```{r}
library(magrittr)
library(nnls)
library(parallel)
library(glmnet)
library(pracma)
```

```{r}
rdiric <- function(k) { rexp(k) %>% {./sum(.)} }
n <- 300
p <- 400
v <- 30
nu <- 0.1
sigmaE <- 0.05
rk <- 3
X <- randn(n, p) %>% abs
B <- matrix(rexp(p * v), p, v)
temp <- randn(n, v)
res <- svd(temp)
U <- res$u[, 1:rk]
V <- res$v[, 1:rk]
d <- nu * abs(rnorm(1)) * rdiric(rk)
FF <- U %*% diag(d) %*% t(V)
EE <- sigmaE * randn(n, v)
mu <- X %*% B
Y <- mu + FF + EE
```

### Component optimizations

Method to do Lagrangian L1 penalty: $$1/2 ||y - X\beta||^2 + \lambda ||\beta||_1$$

```{r}
f2 <- function(x) sum(x^2)
lambda_nnls <- function(X, y, lambda, maxits = 5) {
  l1p <- 0
  for (i in 1:maxits) {
    b <- nnls(rbind(X, l1p), c(y, 0))$x
    l1p <- sqrt(lambda/min(tab[3, ]))
  }
  list(b = b, lambda = l1p^2 * sum(b))
}
```



### ADMM